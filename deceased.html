<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="assets/img/WC_Logo.png" type="image/png" />
    <title>Virtual Graveyard - Deceased</title>
    <link rel="stylesheet" href="./assets/style/global.css" />
    <link rel="stylesheet" href="./assets/style/components/formFooter.css" />
    <link rel="stylesheet" href="./assets/style/components/header.css" />
    <link rel="stylesheet" href="./assets/style/components/footer.css" />
    <link rel="stylesheet" href="./assets/style/components/new_funeral.css" />
    <link rel="stylesheet" href="./assets/style/pages/deceased.css" />
    <link
      rel="stylesheet"
      href="./assets/fonts/fontawesome-free-6.7.2-web/css/all.css"
    />
  </head>

  <body class="page">
    <header class="header">
      <a href="./home.html" class="header__logo">
        <img src="./assets/img/logo.png" alt="Virtual Grave Logo" />
      </a>
      <div class="header__right">
        <div class="header__menu">
          <div class="navbar__top-row">
            <a href="#" class="navbar__btn">
              <span class="navbar__btn-icon">+</span> NEW FUNERAL
            </a>
            <div class="navbar__text-links">
              <a href="./store-souvenir.html">STORE</a>
              <span class="navbar__divider">|</span>
              <a href="#">WEATHER</a>
              <span class="navbar__divider">|</span>
              <a href="./login.html">SIGN IN</a>
            </div>
          </div>

          <nav class="navbar__center">
            <a href="./home.html" class="navbar__link navbar__link--active"
              >GATE</a
            >
            <span class="navbar__divider">|</span>
            <a href="./board.html" class="navbar__link">BOARD</a>
            <span class="navbar__divider">|</span>
            <a href="./cemetery.html" class="navbar__link">CEMETERY</a>
            <span class="navbar__divider">|</span>
            <a href="./catocombs.html" class="navbar__link">CATACOMBS</a>
          </nav>
        </div>

        <div class="header__icons">
          <div class="header__icons-top">
            <button class="fa-solid fa-magnifying-glass"></button>
            <button class="fa-solid fa-volume-high"></button>
            <button title="Language">EN</button>
          </div>

          <div class="header__icons-bottom">
            <span class="cemetery-label">Animals cemetery</span>
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </div>
      </div>
    </header>

    <main class="page-main main night mt-50">
      <div class="flex wrap">
        <div class="title mr-100">New funeral</div>
        <div class="steps flex gap-lg">
          <div class="step">
            <span class="step__number">1</span>
            <p class="step__des mt-16">Place</p>
          </div>
          <span class="steps_span">_</span>
          <!-- 2 -->
          <div class="step">
            <span class="step__number">2</span>
            <p class="step__des mt-16">Tombstone</p>
          </div>
          <span class="steps_span">_</span>
          <!-- 3 -->
          <div class="step active">
            <span class="step__number">3</span>
            <p class="step__des mt-16">Deceased</p>
          </div>
          <span class="steps_span">_</span>
          <!-- 4 -->
          <div class="step">
            <span class="step__number">4</span>
            <p class="step__des mt-16">Necrology</p>
          </div>
          <span class="steps_span">_</span>
          <!-- 5 -->
          <div class="step">
            <span class="step__number">5</span>
            <p class="step__des mt-16">Images</p>
          </div>
          <span class="steps_span">_</span>
          <!-- 6 -->
          <div class="step">
            <span class="step__number">6</span>
            <p class="step__des mt-16">Memory</p>
          </div>
          <span class="steps_span">_</span>
          <!-- 7 -->
          <div class="step">
            <span class="step__number">7</span>
            <p class="step__des mt-16">Summary</p>
          </div>
        </div>
      </div>

      <div class="flex render">
        <!-- img render ở đây -->
        <section class="form-section mt-32">
          <h2 class="form-section__title">Data of the deceased person</h2>
          <form class="form">
            <div class="input-icon form-group">
              <i class="fa-solid fa-user"></i>
              <input
                type="text"
                id="Name"
                class="form-input"
                placeholder="Name*"
                required
              />
              <div id="nameError" class="error-message"></div>
            </div>

            <div class="input-icon form-group">
              <i class="fa-solid fa-user"></i>
              <input
                type="text"
                id="SurName"
                class="form-input"
                placeholder="Surname*"
                required
              />
              <div id="surnameError" class="error-message"></div>
            </div>

            <div class="input-icon form-group">
              <i class="fa-solid fa-id-card"></i>
              <input
                type="text"
                id="Other"
                class="form-input"
                placeholder="Other / known as*"
                required
              />
            </div>

            <div class="input-icon form-group">
              <i class="fa-solid fa-cake-candles"></i>
              <input
                type="date"
                id="birthDate"
                placeholder="BirthDate"
                class="form-input"
                required
              />
            </div>

            <div class="input-icon form-group">
              <i class="fa-solid fa-cross"></i>
              <input
                type="date"
                id="deathDate"
                placeholder="Date of death*"
                class="form-input"
                required
              />
            </div>

            <div class="gender-selection mt-16">
              <label>
                <input type="radio" name="gender" value="male" required />
                <i class="fa-solid fa-mars"></i> Male
              </label>
              <label>
                <input type="radio" name="gender" value="female" />
                <i class="fa-solid fa-venus"></i> Female
              </label>
            </div>

            <div class="custom-check mt-32">
              <label>
                <input type="checkbox" name="isVeteran" />
                I want to generate an obituary
              </label>
              <label class="mt-16">
                <input type="checkbox" name="hasGraveStone" />
                I agree to the one-time publication of the obituary on the
                Facebook social network by the Virtual Cemetery.
              </label>
            </div>
          </form>
        </section>
      </div>

      <div style="margin-bottom: 74px" class="form-footer w-full mt-32">
        <a href="./Tombstone.html" class="form-footer__btn">
          <i class="fa-solid fa-arrow-left"></i> Back
        </a>
        <a
          href="./Necrology.html"
          class="form-footer__btn form-footer__btn--primary"
          id="nextBtn"
        >
          Next <i class="fa-solid fa-arrow-right"></i>
        </a>
      </div>
    </main>

    <footer class="page-footer">
      <div class="footer__links">
        <a href="./about-us.html">ABOUT US</a>
        <span class="footer__divider">|</span>
        <a href="./terms-of-service.html">TERMS OF SERVICE</a>
        <span class="footer__divider">|</span>
        <a href="./legal-aspect.html">LEGAL ASPECT</a>
        <span class="footer__divider">|</span>
        <a href="./price-list.html">PRICE LIST</a>
        <span class="footer__divider">|</span>
        <a href="./psp.html">PSP</a>
        <span class="footer__divider">|</span>
        <a href="./history.html">HISTORY</a>
        <span class="footer__divider">|</span>
        <a href="./affilation.html">AFFILIATION</a>
        <span class="footer__divider">|</span>
        <a href="./contact.html">CONTACT</a>
        <span class="footer__social">
          <i class="fab fa-facebook-f"></i>
          <i class="fab fa-instagram"></i>
          <i class="fab fa-twitter"></i>
          <i class="fab fa-youtube"></i>
        </span>
      </div>
      <p class="footer__copyright">
        All right reserved Virtual Grave &copy; 2025. Design and implementation
        Cyber.pl
      </p>
    </footer>
  </body>
  <script>
    const nameInput = document.getElementById("Name");
    const surnameInput = document.getElementById("SurName");
    const otherInput = document.getElementById("Other");
    const birthDateInput = document.getElementById("birthDate");
    const deathDateInput = document.getElementById("deathDate");
    const genderInputs = document.querySelectorAll("input[name='gender']");
    const isVeteranInput = document.querySelector("input[name='isVeteran']");
    const hasGraveStoneInput = document.querySelector(
      "input[name='hasGraveStone']"
    );
    const nextBtn = document.getElementById("nextBtn");

    const selectedImg = localStorage.getItem("selectedTombstone");

    function validateName(value) {
      const words = value.trim().split(/\s+/);
      if (words.length > 1) {
        return "Name must be only one word.";
      }
      if (words[0]?.length > 8) {
        return "Name cannot be more than 8 characters.";
      }
      return "";
    }

    function validateSurname(value) {
      const words = value.trim().split(/\s+/);
      if (words.length > 1) {
        return "Surname must be at most one words.";
      }
      for (const word of words) {
        if (word.length > 8) {
          return "Each word in surname cannot be more than 8 characters.";
        }
      }
      return "";
    }

    nameInput.addEventListener("input", () => {
      const msg = validateName(nameInput.value);
      nameError.textContent = msg;
      nameInput.classList.toggle("input-error", msg !== "");
    });

    surnameInput.addEventListener("input", () => {
      const msg = validateSurname(surnameInput.value);
      surnameError.textContent = msg;
      surnameInput.classList.toggle("input-error", msg !== "");
    });

    if (selectedImg) {
      const imgPreview = document.createElement("div");
      imgPreview.className = "selected-tombstone mt-32";
      let tombstoneTextClass = "";
      const patterns = [
        { path: "tombstones", prefix: "tombstone" },
        { path: "tombstones-family", prefix: "tombstone-family" },
        { path: "catabombs", prefix: "catacomb" },
      ];

      for (let { path, prefix } of patterns) {
        for (let i = 1; i <= 8; i++) {
          if (selectedImg.includes(`./assets/img/${path}/${i}.png`)) {
            tombstoneTextClass = `${prefix}-${i}`;
            break;
          }
        }
        if (tombstoneTextClass) break;
      }

      imgPreview.innerHTML = `
        <div class="image-card ${tombstoneTextClass}">
          <img src="${selectedImg}" alt="Selected Tombstone" />
          <div id="tombstoneText" class="tombstone-text"></div>
        </div>
      `;
      document.querySelector(".render").prepend(imgPreview);
    }

    function updateTombstoneText() {
      const name = nameInput.value.trim();
      const surname = surnameInput.value.trim();
      const birthDate = birthDateInput.value;
      const deathDate = deathDateInput.value;
      const gender = document.querySelector("input[name='gender']:checked");

      if (!name || !surname || !birthDate || !deathDate || !gender) return;

      const pronoun = gender.value === "male" ? "He" : "She";

      // Lấy từ đầu tiên của name
      const nameFirstWord = name.split(/\s+/)[0];

      // Lấy tối đa 2 từ đầu tiên của surname và thêm "..." nếu còn từ
      const surnameWords = surname.split(/\s+/);
      let shortSurname = surnameWords.slice(0, 2).join(" ");
      if (surnameWords.length > 2) {
        shortSurname += " ...";
      }

      const tombstoneTextDiv = document.getElementById("tombstoneText");
      if (tombstoneTextDiv) {
        tombstoneTextDiv.innerHTML = `
      <div class="tombstone-name">${nameFirstWord} <span>${shortSurname}</span></div>
      <div class="tombstone-birth">
        born: <br/> ${birthDate}
      </div>
      <div class="tombstone-death">
        ${pronoun} died on: <br/> ${deathDate}
      </div>
    `;
      }
    }

    function validateForm() {
      const name = nameInput.value.trim();
      const surname = surnameInput.value.trim();
      const other = otherInput.value.trim();
      const birthDate = birthDateInput.value;
      const deathDate = deathDateInput.value;
      const gender = document.querySelector("input[name='gender']:checked");

      if (!name || !surname || !other || !birthDate || !deathDate || !gender) {
        return false;
      }

      const nameErrorMsg = validateName(name);
      const surnameErrorMsg = validateSurname(surname);
      if (nameErrorMsg || surnameErrorMsg) {
        alert(nameErrorMsg || surnameErrorMsg);
        return false;
      }

      return true;
    }

    nextBtn.addEventListener("click", function (e) {
      if (!validateForm()) {
        e.preventDefault(); // chặn chuyển trang
        alert("Please fill in all the required fields!");
        return;
      }

      const gender = document.querySelector(
        "input[name='gender']:checked"
      ).value;

      const formData = {
        name: nameInput.value.trim(),
        surname: surnameInput.value.trim(),
        other: otherInput.value.trim(),
        birthDate: birthDateInput.value,
        deathDate: deathDateInput.value,
        gender: gender,
        isVeteran: isVeteranInput.checked,
        hasGraveStone: hasGraveStoneInput.checked,
      };

      localStorage.setItem("deceasedData", JSON.stringify(formData));
    });

    nameInput.addEventListener("input", updateTombstoneText);
    surnameInput.addEventListener("input", updateTombstoneText);
    birthDateInput.addEventListener("input", updateTombstoneText);
    deathDateInput.addEventListener("input", updateTombstoneText);
    genderInputs.forEach((input) => {
      input.addEventListener("change", updateTombstoneText);
    });
  </script>

  <script src="./assets/scripts/footer.js"></script>
</html>
